<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/favicon.ico"/><title>System Design</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="The non-Tech Second Brain of Kyle Tycholiz"/><meta property="og:title" content="System Design"/><meta property="og:description" content="The non-Tech Second Brain of Kyle Tycholiz"/><meta property="og:url" content="https://thoughts.kyletycholiz.com/notes/2nkj5u7bxt3fo99x5t039qk/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="6/6/2023"/><meta property="article:modified_time" content="7/27/2023"/><link rel="canonical" href="https://thoughts.kyletycholiz.com/notes/2nkj5u7bxt3fo99x5t039qk/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/8e7b7e4bce421c0a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8e7b7e4bce421c0a.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-3d209faeb64f2f97.js" defer=""></script><script src="/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/_next/static/chunks/main-104451f3d1a5c4bc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6b338472289fe290.js" defer=""></script><script src="/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/_next/static/Ev72apsD0Krsz6dJLOqfG/_buildManifest.js" defer=""></script><script src="/_next/static/Ev72apsD0Krsz6dJLOqfG/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="system-design">System Design<a aria-hidden="true" class="anchor-heading icon-link" href="#system-design"></a></h1>
<p><img src="/assets/images/2023-07-24-21-01-42.png"></p>
<ul>
<li><a href="https://vahid.blog/post/2022-05-05-system-design-interview-cheat-sheet/">source &#x26; elaboration</a></li>
</ul>
<h1 id="early-considerations">Early Considerations<a aria-hidden="true" class="anchor-heading icon-link" href="#early-considerations"></a></h1>
<h2 id="define-scope">Define scope<a aria-hidden="true" class="anchor-heading icon-link" href="#define-scope"></a></h2>
<ol>
<li>Describe the potential surface area of the application, listing out features. Anything is on the table</li>
<li>Constrain the scope with the interviewer
<ul>
<li>What domain primitives do we have?</li>
</ul>
</li>
</ol>
<h2 id="back-of-the-envelope">Back-of-the-envelope<a aria-hidden="true" class="anchor-heading icon-link" href="#back-of-the-envelope"></a></h2>
<ul>
<li>How much main domain data are we storing?
<ul>
<li>ex. if Spotify, how many songs are we storing? If Facebook, how many posts are we storing?</li>
</ul>
</li>
<li>How many users?</li>
</ul>
<h2 id="user-traffic-patterns">User traffic patterns<a aria-hidden="true" class="anchor-heading icon-link" href="#user-traffic-patterns"></a></h2>
<ul>
<li>How many daily active users (DAU)? </li>
<li>How many concurrent users anticipated?</li>
</ul>
<p>How does the typical user use our application?</p>
<ul>
<li><em>Sequential Access Pattern</em> - Users follow a sequential or linear path through the application or website. 
<ul>
<li>ex. in a step-by-step registration process or an e-commerce checkout flow, users move from one page to the next in a predefined sequence.</li>
</ul>
</li>
<li><em>Random Access Pattern</em> - Users access different pages or features of the application in a non-linear, unpredictable manner. They commonly arrive directly from search engine results, bookmarks, or external links.
<ul>
<li>ex. Wikipedia</li>
</ul>
</li>
<li><em>Bursty Traffic Pattern</em> - Occasional spikes in traffic or usage, typically caused by specific events, promotions, or viral content.
<ul>
<li>ex. Ticketmaster pre-sales</li>
</ul>
</li>
<li><em>Daily/Weekly/Seasonal Traffic Pattern</em> - Consistent variations in user traffic based on specific days of the week or times of day. 
<ul>
<li>ex. e-commerce platforms experience higher traffic during holiday seasons.</li>
</ul>
</li>
<li><em>Recurring Traffic Pattern</em> - Users return to the same pages or features regularly 
<ul>
<li>ex. daily news readers or social media platforms.</li>
</ul>
</li>
</ul>
<h2 id="rough-high-level-component-design">Rough high-level component design<a aria-hidden="true" class="anchor-heading icon-link" href="#rough-high-level-component-design"></a></h2>
<p>Once we have all high-level components in place, run through a use-case</p>
<ul>
<li>ex. in Spotify, when a user plays a song, the selected songId is sent from the client to the application server, which sends a query to the relational database to get the song record. Included in the song record is the URL where the <code>.mp3</code> is stored in the blob storage database...</li>
</ul>
<h3 id="database">Database<a aria-hidden="true" class="anchor-heading icon-link" href="#database"></a></h3>
<ul>
<li>SQL or NoSQL?</li>
<li>Rough table design</li>
</ul>
<hr>
<h2 id="fault-tolerance">Fault tolerance<a aria-hidden="true" class="anchor-heading icon-link" href="#fault-tolerance"></a></h2>
<ul>
<li><a title="Private" href="https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html" target="_blank" class="private">deploy.distributed.CAP-theorem (Private)</a>: should <em>availability</em> or <em>consistency</em> be prioritized?</li>
<li>automatic leader promotion on failure</li>
<li>RDBMS provides a WAL for improved fault-tolerance</li>
</ul>
<h2 id="scaling">Scaling<a aria-hidden="true" class="anchor-heading icon-link" href="#scaling"></a></h2>
<ul>
<li>Microservice architecture for independent scaling of nodes</li>
<li>Offload non-critical tasks to a job-queue (implemented with something like Redis streams or Apache Kafka)</li>
<li>what is the <code>read:write</code> ratio?</li>
</ul>
<hr>
<h1 id="database-1">Database<a aria-hidden="true" class="anchor-heading icon-link" href="#database-1"></a></h1>
<h2 id="main-app">Main app<a aria-hidden="true" class="anchor-heading icon-link" href="#main-app"></a></h2>
<h3 id="write-heavy-databases">Write-heavy databases<a aria-hidden="true" class="anchor-heading icon-link" href="#write-heavy-databases"></a></h3>
<p>Consider how read-heavy the data in your application is. Write heavy dbs may face scalability issues. </p>
<ul>
<li>For instance, maybe 5x more people are uploading data than are downloading it (a 1:5 read:write ratio). Let's assume 1M writes per day, giving us 5M reads</li>
</ul>
<p>Things to consider</p>
<ul>
<li>Does read data need to be consistent with what was just written? If not, we can cache.</li>
<li>Efficient indexing (recall that indexes slow down write operations)</li>
<li>query optimization necessary</li>
<li>Batching write queries to reduce overhead of establishing connections, executing queries and committing transactions.</li>
<li>offload write operations to an asynchronous processing mechanism (e.g. queue)</li>
<li>implement replication and sharding to distribute writes across multiple replicas</li>
</ul>
<p>If using counters (likes, votes etc.), use distributed counters to distribute load</p>
<p>Can implement caching mechanisms using Redis to reduce load on database</p>
<h3 id="read-heavy-databases">Read-heavy databases<a aria-hidden="true" class="anchor-heading icon-link" href="#read-heavy-databases"></a></h3>
<p>Things to consider</p>
<ul>
<li>Implement efficient indexing on read-heavy sets of data
<ul>
<li>Identify the most frequently executed queries and create indexes on the relevant columns to support them.</li>
</ul>
</li>
<li>Implement caching mechanisms</li>
<li>Use replication to distribute load over multiple replicas</li>
<li>Use load balancing to distribute load over multiple application servers</li>
<li>Consider denormalization to reduce amount of joins needed</li>
<li>Query optimization</li>
</ul>
<h3 id="scaling-1">Scaling<a aria-hidden="true" class="anchor-heading icon-link" href="#scaling-1"></a></h3>
<ul>
<li>Implement read replicas</li>
<li>Vertically scaling the database to upgrade CPU, RAM and storage</li>
<li>Sharding (ie. horizontal scaling) the database can help distribute the load</li>
</ul>
<h3 id="storage">Storage<a aria-hidden="true" class="anchor-heading icon-link" href="#storage"></a></h3>
<ul>
<li>Consider moving a certain subset of the data to cold storage to save on costs</li>
</ul>
<h2 id="authentication">Authentication<a aria-hidden="true" class="anchor-heading icon-link" href="#authentication"></a></h2>
<ul>
<li>Handling large number of registrations and logins will put strain on auth service
<ul>
<li>Consider holding a separate database for our auth service, which will issue JWTs to autenticated users, and will verify JWTs.</li>
</ul>
</li>
</ul>
<h1 id="static-content">Static content<a aria-hidden="true" class="anchor-heading icon-link" href="#static-content"></a></h1>
<ul>
<li>serving static content and handling increased traffic will put a strain on the server and affect the user experience.
<ul>
<li>leverage a CDN to offload static asset serving and improve load times.</li>
</ul>
</li>
</ul>
<h1 id="cache">Cache<a aria-hidden="true" class="anchor-heading icon-link" href="#cache"></a></h1>
<ul>
<li>Managing cache validation and ensuring consistency of content across distributed servers can present challenges
<ul>
<li>Implement cache versioning and cache invalidation strategies (e.g., using cache headers or file hashing) to maintain consistency.</li>
</ul>
</li>
<li>We can cache some of the hot data points that are frequently accessed. Following the 80-20 rule, meaning 20% of hot data points generate 80% of traffic, we would like to cache these 20% data points.
<ul>
<li>ex. if designing a paste-bin clone, cache the top 20% of most accessed pastes.</li>
</ul>
</li>
</ul>
<h1 id="application-servers">Application Server(s)<a aria-hidden="true" class="anchor-heading icon-link" href="#application-servers"></a></h1>
<ul>
<li>if there is concurrently high number of writes to database, make use of message queue like Kafka to decouple the write (eg. Reddit post submission) from the main application </li>
</ul>
<h1 id="scaling-and-high-availability">Scaling and High Availability<a aria-hidden="true" class="anchor-heading icon-link" href="#scaling-and-high-availability"></a></h1>
<ul>
<li>Scaling the system and maintaining high availability across multiple regions can be complex.
<ul>
<li>Employ horizontal scaling by adding more servers and use load balancers to distribute the load.</li>
<li>Implement an automated monitoring and alerting system to help identify and address issues</li>
<li>Employ failover mechanisms to automatically switch to backup systems in case of failure.</li>
</ul>
</li>
<li>Coordinating data replication and ensuring consistency during updates are challenges.
<ul>
<li>Techniques like database replication, data partitioning, and distributed caching can enhance availability and scalability. </li>
</ul>
</li>
</ul>
<hr>
<h2 id="capacity-estimation-and-constraints">Capacity Estimation and Constraints<a aria-hidden="true" class="anchor-heading icon-link" href="#capacity-estimation-and-constraints"></a></h2>
<p>Can users upload as much as they want? For instance, if we were building Instagram, we would want to make efficient storage of photos a top priority.</p>
<h3 id="leveraging-user-expectations">Leveraging User Expectations<a aria-hidden="true" class="anchor-heading icon-link" href="#leveraging-user-expectations"></a></h3>
<p>Have a good understanding of user expectations while designing the application. For instance, in an Instagram-clone, it's not necessary that every user sees the latest content at any given time— we can tolerate some delay. This enables us to retract our focus from strict caching and replication implementations, and instead focus on things that are more important for our system.</p>
<p>How fast do writes need to be? How about reads?</p>
<ul>
<li>For Instagram, fast uploads would not be expected by users. Reads, on the other hand would be expected, since there is a high degree of swiping going on. For this, we'd want to have a more sophisticated caching system in place.</li>
<li>We should keep in mind that web servers have a connection limit before designing our system. If we assume that a web server can have a maximum of 500 connections at any time, then it can’t have more than 500 concurrent uploads or reads. To handle this bottleneck, we can split reads and writes into separate services. We can have dedicated servers for reads and different servers for writes to ensure that uploads don’t hog the system. This has the added benefit of being able to scale each set of services independently.</li>
<li>If users can upload a large amount of data, then efficient management of storage should also be a focus</li>
</ul>
<p>How reliable is your app expected to be?</p>
<ul>
<li>if you are Instagram, your users expect 100% reliability. Therefore, you should store multiple copies of each file so that if one storage server dies, the photo can be retrieved from the other copy present on a different storage server.
<ul>
<li>If we want to have high availability of the system, we need to have multiple replicas of services running in the system so that even if a few services die down, the system remains available and running. Redundancy removes the single point of failure in the system.</li>
</ul>
</li>
</ul>
<h3 id="redundancy">Redundancy<a aria-hidden="true" class="anchor-heading icon-link" href="#redundancy"></a></h3>
<p>All potential bottlenecks and points of failure should be scrutinized. Think of how the system gets more complex as we implement [sharding|db.strategies.sharding]. Now we need a sharding rule to determine in which shard a row is stored. Suppose we implement round robin with <code>recordId % 10</code> to spread out the records evenly. Well, now we have a new problem: we cannot have the shards increment the IDs themselves, since we need the ID first before we can even determine which shard it belongs in. So to solve that, we need some sort of external key generating service. This service can generate IDs, store them in a table (to indicate that it is used) when a new item is created. Each shard can use this service, and we can have perfectly incremented IDs across all shards. However, one last issue arises. This key generation system is now a single point of failure, so we have to iterate further. We could spin up another such key generating service, and split the load between them by having one service give out even-numbered IDs and the other odd-numbered IDs. Finally, we can stick a load balancer in front of them to round-robin the load between them. In case of failure of the even-numbered service, the only consequence is that there will be more odd-numbered IDs; something we probably don't even care about.</p>
<h3 id="back-of-the-envelope-estimations">Back-of-the-envelope Estimations<a aria-hidden="true" class="anchor-heading icon-link" href="#back-of-the-envelope-estimations"></a></h3>
<p>From there, assume that each item is 10KB, so we need to store 10GB per day. If we want to store this data for an average of 10 years then we need storage capacity of 36TB.</p>
<ul>
<li>To keep some margin, we will assume a 70% capacity model (meaning we don’t want to use more than 70% of our total storage capacity at any point), which raises our storage needs to 51.4TB.</li>
</ul>
<p>New items per second:</p>
<ul>
<li>1M / (24 hours * 3600 seconds) ~= 12 pastes/sec
results in
120KB of ingress per second.</li>
<li>12 * 10KB => 120 KB/s</li>
</ul>
<p>Reads per second:</p>
<ul>
<li>5M / (24 hours * 3600 seconds) ~= 58 reads/sec
results in
total data egress (sent to users) will be 0.6 MB/s.</li>
<li>58 * 10KB => 0.6 MB/s</li>
</ul>
<p>This number of records totals 3.6 Billion in 10 years. Since 6 random <a title="Private" href="https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html" target="_blank" class="private">base64 encoding (Private)</a> ([A-Z, a-z, 0-9, ., -]) can be used to generate 68.7 billion unique strings, this should be sufficient for uniqueness.</p>
<p>Since we have 5M read requests per day, to cache 20% of these requests, we would need:</p>
<ul>
<li>0.2 <em> 5M </em> 10KB ~= 10 GB</li>
</ul>
<hr>
<h2 id="dendron-notes-to-review">Dendron notes to review<a aria-hidden="true" class="anchor-heading icon-link" href="#dendron-notes-to-review"></a></h2>
<ul>
<li><a title="Private" href="https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html" target="_blank" class="private">auth.tokens.jwt (Private)</a></li>
<li><a title="Private" href="https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html" target="_blank" class="private">api.gateway (Private)</a></li>
<li><a title="Private" href="https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html" target="_blank" class="private">deploy.distributed.CAP-theorem (Private)</a></li>
</ul>
<h2 id="e-resources">E Resources<a aria-hidden="true" class="anchor-heading icon-link" href="#e-resources"></a></h2>
<ul>
<li><a href="https://systemdesign.one/slack-architecture/">Slack architecture</a></li>
<li><a href="https://systemdesign.one/back-of-the-envelope/">Back-of-the-envelope analysis</a></li>
</ul>
<h2 id="resources">Resources<a aria-hidden="true" class="anchor-heading icon-link" href="#resources"></a></h2>
<ul>
<li><a href="https://github.com/donnemartin/system-design-primer">System Design Primer</a></li>
<li><a href="https://systemdesign.one/distributed-counter-system-design/">Distributed counter design</a></li>
<li><a href="https://systemdesign.one/real-time-presence-platform-system-design/">Real-time presence design</a></li>
<li><a href="https://systemdesign.one/live-comment-system-design/">Live comment system design</a></li>
<li><a href="https://systemdesign.one/leaderboard-system-design/">Leaderboard system design</a></li>
<li><a href="https://systemdesign.one/system-design-pastebin/">Pastebin system design</a></li>
<li><a href="https://systemdesign.one/url-shortening-system-design/">URL shortening system design</a></li>
<li><a href="https://systemdesign.one/what-is-service-discovery/">Service Discovery</a></li>
<li><a href="https://hackingthesystemsdesigninterview.com/">Various system designs</a></li>
<li><a href="https://github.com/puncsky/system-design-and-architecture">System Design and Architecture</a></li>
<li><a href="https://systemdesign.one/system-design-interview-cheatsheet">System design cheatsheet</a></li>
<li><a href="https://www.youtube.com/@IGotAnOffer-Engineering">Youtube series: System Design</a></li>
</ul></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#early-considerations" title="Early Considerations">Early Considerations</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#define-scope" title="Define scope">Define scope</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#back-of-the-envelope" title="Back-of-the-envelope">Back-of-the-envelope</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#user-traffic-patterns" title="User traffic patterns">User traffic patterns</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#rough-high-level-component-design" title="Rough high-level component design">Rough high-level component design</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#database" title="Database">Database</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#fault-tolerance" title="Fault tolerance">Fault tolerance</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#scaling" title="Scaling">Scaling</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#database-1" title="Database">Database</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#main-app" title="Main app">Main app</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#write-heavy-databases" title="Write-heavy databases">Write-heavy databases</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#read-heavy-databases" title="Read-heavy databases">Read-heavy databases</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#scaling-1" title="Scaling">Scaling</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#storage" title="Storage">Storage</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#authentication" title="Authentication">Authentication</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#static-content" title="Static content">Static content</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#cache" title="Cache">Cache</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#application-servers" title="Application Server(s)">Application Server(s)</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#scaling-and-high-availability" title="Scaling and High Availability">Scaling and High Availability</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#capacity-estimation-and-constraints" title="Capacity Estimation and Constraints">Capacity Estimation and Constraints</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#leveraging-user-expectations" title="Leveraging User Expectations">Leveraging User Expectations</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#redundancy" title="Redundancy">Redundancy</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#back-of-the-envelope-estimations" title="Back-of-the-envelope Estimations">Back-of-the-envelope Estimations</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#dendron-notes-to-review" title="Dendron notes to review">Dendron notes to review</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#e-resources" title="E Resources">E Resources</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#resources" title="Resources">Resources</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"2nkj5u7bxt3fo99x5t039qk","title":"System Design","desc":"","updated":1690483544464,"created":1686077337312,"custom":{},"fname":"business.hiring.interviewee.software.system-design","type":"note","vault":{"fsPath":"../main/thoughts-on","name":"thoughts-on"},"contentHash":"9cff899171c495266d281b30d1b49970","links":[{"type":"wiki","from":{"fname":"business.hiring.interviewee.software.system-design","id":"2nkj5u7bxt3fo99x5t039qk","vaultName":"thoughts-on"},"value":"deploy.distributed.CAP-theorem","position":{"start":{"line":43,"column":3,"offset":2200},"end":{"line":43,"column":37,"offset":2234},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"deploy.distributed.CAP-theorem"}},{"type":"wiki","from":{"fname":"business.hiring.interviewee.software.system-design","id":"2nkj5u7bxt3fo99x5t039qk","vaultName":"thoughts-on"},"value":"binary.encoding.base64","alias":"base64 encoding","position":{"start":{"line":151,"column":71,"offset":10309},"end":{"line":151,"column":113,"offset":10351},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"binary.encoding.base64"}},{"type":"wiki","from":{"fname":"business.hiring.interviewee.software.system-design","id":"2nkj5u7bxt3fo99x5t039qk","vaultName":"thoughts-on"},"value":"auth.tokens.jwt","position":{"start":{"line":160,"column":3,"offset":10624},"end":{"line":160,"column":22,"offset":10643},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"auth.tokens.jwt"}},{"type":"wiki","from":{"fname":"business.hiring.interviewee.software.system-design","id":"2nkj5u7bxt3fo99x5t039qk","vaultName":"thoughts-on"},"value":"api.gateway","position":{"start":{"line":161,"column":3,"offset":10646},"end":{"line":161,"column":18,"offset":10661},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"api.gateway"}},{"type":"wiki","from":{"fname":"business.hiring.interviewee.software.system-design","id":"2nkj5u7bxt3fo99x5t039qk","vaultName":"thoughts-on"},"value":"deploy.distributed.CAP-theorem","position":{"start":{"line":162,"column":3,"offset":10664},"end":{"line":162,"column":37,"offset":10698},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"deploy.distributed.CAP-theorem"}}],"anchors":{"early-considerations":{"type":"header","text":"Early Considerations","value":"early-considerations","line":11,"column":0,"depth":1},"define-scope":{"type":"header","text":"Define scope","value":"define-scope","line":12,"column":0,"depth":2},"back-of-the-envelope":{"type":"header","text":"Back-of-the-envelope","value":"back-of-the-envelope","line":17,"column":0,"depth":2},"user-traffic-patterns":{"type":"header","text":"User traffic patterns","value":"user-traffic-patterns","line":22,"column":0,"depth":2},"rough-high-level-component-design":{"type":"header","text":"Rough high-level component design","value":"rough-high-level-component-design","line":38,"column":0,"depth":2},"database":{"type":"header","text":"Database","value":"database","line":42,"column":0,"depth":3},"fault-tolerance":{"type":"header","text":"Fault tolerance","value":"fault-tolerance","line":48,"column":0,"depth":2},"scaling":{"type":"header","text":"Scaling","value":"scaling","line":53,"column":0,"depth":2},"database-1":{"type":"header","text":"Database","value":"database-1","line":60,"column":0,"depth":1},"main-app":{"type":"header","text":"Main app","value":"main-app","line":61,"column":0,"depth":2},"write-heavy-databases":{"type":"header","text":"Write-heavy databases","value":"write-heavy-databases","line":62,"column":0,"depth":3},"read-heavy-databases":{"type":"header","text":"Read-heavy databases","value":"read-heavy-databases","line":78,"column":0,"depth":3},"scaling-1":{"type":"header","text":"Scaling","value":"scaling-1","line":88,"column":0,"depth":3},"storage":{"type":"header","text":"Storage","value":"storage","line":93,"column":0,"depth":3},"authentication":{"type":"header","text":"Authentication","value":"authentication","line":96,"column":0,"depth":2},"static-content":{"type":"header","text":"Static content","value":"static-content","line":100,"column":0,"depth":1},"cache":{"type":"header","text":"Cache","value":"cache","line":104,"column":0,"depth":1},"application-servers":{"type":"header","text":"Application Server(s)","value":"application-servers","line":110,"column":0,"depth":1},"scaling-and-high-availability":{"type":"header","text":"Scaling and High Availability","value":"scaling-and-high-availability","line":113,"column":0,"depth":1},"capacity-estimation-and-constraints":{"type":"header","text":"Capacity Estimation and Constraints","value":"capacity-estimation-and-constraints","line":123,"column":0,"depth":2},"leveraging-user-expectations":{"type":"header","text":"Leveraging User Expectations","value":"leveraging-user-expectations","line":126,"column":0,"depth":3},"redundancy":{"type":"header","text":"Redundancy","value":"redundancy","line":138,"column":0,"depth":3},"back-of-the-envelope-estimations":{"type":"header","text":"Back-of-the-envelope Estimations","value":"back-of-the-envelope-estimations","line":141,"column":0,"depth":3},"dendron-notes-to-review":{"type":"header","text":"Dendron notes to review","value":"dendron-notes-to-review","line":165,"column":0,"depth":2},"e-resources":{"type":"header","text":"E Resources","value":"e-resources","line":170,"column":0,"depth":2},"resources":{"type":"header","text":"Resources","value":"resources","line":174,"column":0,"depth":2}},"children":[],"parent":"9NOzZg8odjShrSKIE9GtG","data":{}},"body":"\u003ch1 id=\"system-design\"\u003eSystem Design\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#system-design\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003e\u003cimg src=\"/assets/images/2023-07-24-21-01-42.png\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://vahid.blog/post/2022-05-05-system-design-interview-cheat-sheet/\"\u003esource \u0026#x26; elaboration\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"early-considerations\"\u003eEarly Considerations\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#early-considerations\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003ch2 id=\"define-scope\"\u003eDefine scope\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#define-scope\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003eDescribe the potential surface area of the application, listing out features. Anything is on the table\u003c/li\u003e\n\u003cli\u003eConstrain the scope with the interviewer\n\u003cul\u003e\n\u003cli\u003eWhat domain primitives do we have?\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"back-of-the-envelope\"\u003eBack-of-the-envelope\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#back-of-the-envelope\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eHow much main domain data are we storing?\n\u003cul\u003e\n\u003cli\u003eex. if Spotify, how many songs are we storing? If Facebook, how many posts are we storing?\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eHow many users?\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"user-traffic-patterns\"\u003eUser traffic patterns\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#user-traffic-patterns\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eHow many daily active users (DAU)? \u003c/li\u003e\n\u003cli\u003eHow many concurrent users anticipated?\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eHow does the typical user use our application?\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cem\u003eSequential Access Pattern\u003c/em\u003e - Users follow a sequential or linear path through the application or website. \n\u003cul\u003e\n\u003cli\u003eex. in a step-by-step registration process or an e-commerce checkout flow, users move from one page to the next in a predefined sequence.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cem\u003eRandom Access Pattern\u003c/em\u003e - Users access different pages or features of the application in a non-linear, unpredictable manner. They commonly arrive directly from search engine results, bookmarks, or external links.\n\u003cul\u003e\n\u003cli\u003eex. Wikipedia\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cem\u003eBursty Traffic Pattern\u003c/em\u003e - Occasional spikes in traffic or usage, typically caused by specific events, promotions, or viral content.\n\u003cul\u003e\n\u003cli\u003eex. Ticketmaster pre-sales\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cem\u003eDaily/Weekly/Seasonal Traffic Pattern\u003c/em\u003e - Consistent variations in user traffic based on specific days of the week or times of day. \n\u003cul\u003e\n\u003cli\u003eex. e-commerce platforms experience higher traffic during holiday seasons.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cem\u003eRecurring Traffic Pattern\u003c/em\u003e - Users return to the same pages or features regularly \n\u003cul\u003e\n\u003cli\u003eex. daily news readers or social media platforms.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"rough-high-level-component-design\"\u003eRough high-level component design\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#rough-high-level-component-design\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eOnce we have all high-level components in place, run through a use-case\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eex. in Spotify, when a user plays a song, the selected songId is sent from the client to the application server, which sends a query to the relational database to get the song record. Included in the song record is the URL where the \u003ccode\u003e.mp3\u003c/code\u003e is stored in the blob storage database...\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"database\"\u003eDatabase\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#database\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eSQL or NoSQL?\u003c/li\u003e\n\u003cli\u003eRough table design\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"fault-tolerance\"\u003eFault tolerance\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#fault-tolerance\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca title=\"Private\" href=\"https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html\" target=\"_blank\" class=\"private\"\u003edeploy.distributed.CAP-theorem (Private)\u003c/a\u003e: should \u003cem\u003eavailability\u003c/em\u003e or \u003cem\u003econsistency\u003c/em\u003e be prioritized?\u003c/li\u003e\n\u003cli\u003eautomatic leader promotion on failure\u003c/li\u003e\n\u003cli\u003eRDBMS provides a WAL for improved fault-tolerance\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"scaling\"\u003eScaling\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#scaling\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eMicroservice architecture for independent scaling of nodes\u003c/li\u003e\n\u003cli\u003eOffload non-critical tasks to a job-queue (implemented with something like Redis streams or Apache Kafka)\u003c/li\u003e\n\u003cli\u003ewhat is the \u003ccode\u003eread:write\u003c/code\u003e ratio?\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch1 id=\"database-1\"\u003eDatabase\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#database-1\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003ch2 id=\"main-app\"\u003eMain app\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#main-app\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"write-heavy-databases\"\u003eWrite-heavy databases\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#write-heavy-databases\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eConsider how read-heavy the data in your application is. Write heavy dbs may face scalability issues. \u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFor instance, maybe 5x more people are uploading data than are downloading it (a 1:5 read:write ratio). Let's assume 1M writes per day, giving us 5M reads\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThings to consider\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDoes read data need to be consistent with what was just written? If not, we can cache.\u003c/li\u003e\n\u003cli\u003eEfficient indexing (recall that indexes slow down write operations)\u003c/li\u003e\n\u003cli\u003equery optimization necessary\u003c/li\u003e\n\u003cli\u003eBatching write queries to reduce overhead of establishing connections, executing queries and committing transactions.\u003c/li\u003e\n\u003cli\u003eoffload write operations to an asynchronous processing mechanism (e.g. queue)\u003c/li\u003e\n\u003cli\u003eimplement replication and sharding to distribute writes across multiple replicas\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIf using counters (likes, votes etc.), use distributed counters to distribute load\u003c/p\u003e\n\u003cp\u003eCan implement caching mechanisms using Redis to reduce load on database\u003c/p\u003e\n\u003ch3 id=\"read-heavy-databases\"\u003eRead-heavy databases\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#read-heavy-databases\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThings to consider\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eImplement efficient indexing on read-heavy sets of data\n\u003cul\u003e\n\u003cli\u003eIdentify the most frequently executed queries and create indexes on the relevant columns to support them.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eImplement caching mechanisms\u003c/li\u003e\n\u003cli\u003eUse replication to distribute load over multiple replicas\u003c/li\u003e\n\u003cli\u003eUse load balancing to distribute load over multiple application servers\u003c/li\u003e\n\u003cli\u003eConsider denormalization to reduce amount of joins needed\u003c/li\u003e\n\u003cli\u003eQuery optimization\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"scaling-1\"\u003eScaling\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#scaling-1\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eImplement read replicas\u003c/li\u003e\n\u003cli\u003eVertically scaling the database to upgrade CPU, RAM and storage\u003c/li\u003e\n\u003cli\u003eSharding (ie. horizontal scaling) the database can help distribute the load\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"storage\"\u003eStorage\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#storage\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eConsider moving a certain subset of the data to cold storage to save on costs\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"authentication\"\u003eAuthentication\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#authentication\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eHandling large number of registrations and logins will put strain on auth service\n\u003cul\u003e\n\u003cli\u003eConsider holding a separate database for our auth service, which will issue JWTs to autenticated users, and will verify JWTs.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"static-content\"\u003eStatic content\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#static-content\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eserving static content and handling increased traffic will put a strain on the server and affect the user experience.\n\u003cul\u003e\n\u003cli\u003eleverage a CDN to offload static asset serving and improve load times.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"cache\"\u003eCache\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#cache\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eManaging cache validation and ensuring consistency of content across distributed servers can present challenges\n\u003cul\u003e\n\u003cli\u003eImplement cache versioning and cache invalidation strategies (e.g., using cache headers or file hashing) to maintain consistency.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eWe can cache some of the hot data points that are frequently accessed. Following the 80-20 rule, meaning 20% of hot data points generate 80% of traffic, we would like to cache these 20% data points.\n\u003cul\u003e\n\u003cli\u003eex. if designing a paste-bin clone, cache the top 20% of most accessed pastes.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"application-servers\"\u003eApplication Server(s)\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#application-servers\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eif there is concurrently high number of writes to database, make use of message queue like Kafka to decouple the write (eg. Reddit post submission) from the main application \u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"scaling-and-high-availability\"\u003eScaling and High Availability\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#scaling-and-high-availability\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eScaling the system and maintaining high availability across multiple regions can be complex.\n\u003cul\u003e\n\u003cli\u003eEmploy horizontal scaling by adding more servers and use load balancers to distribute the load.\u003c/li\u003e\n\u003cli\u003eImplement an automated monitoring and alerting system to help identify and address issues\u003c/li\u003e\n\u003cli\u003eEmploy failover mechanisms to automatically switch to backup systems in case of failure.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eCoordinating data replication and ensuring consistency during updates are challenges.\n\u003cul\u003e\n\u003cli\u003eTechniques like database replication, data partitioning, and distributed caching can enhance availability and scalability. \u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"capacity-estimation-and-constraints\"\u003eCapacity Estimation and Constraints\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#capacity-estimation-and-constraints\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eCan users upload as much as they want? For instance, if we were building Instagram, we would want to make efficient storage of photos a top priority.\u003c/p\u003e\n\u003ch3 id=\"leveraging-user-expectations\"\u003eLeveraging User Expectations\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#leveraging-user-expectations\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eHave a good understanding of user expectations while designing the application. For instance, in an Instagram-clone, it's not necessary that every user sees the latest content at any given time— we can tolerate some delay. This enables us to retract our focus from strict caching and replication implementations, and instead focus on things that are more important for our system.\u003c/p\u003e\n\u003cp\u003eHow fast do writes need to be? How about reads?\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFor Instagram, fast uploads would not be expected by users. Reads, on the other hand would be expected, since there is a high degree of swiping going on. For this, we'd want to have a more sophisticated caching system in place.\u003c/li\u003e\n\u003cli\u003eWe should keep in mind that web servers have a connection limit before designing our system. If we assume that a web server can have a maximum of 500 connections at any time, then it can’t have more than 500 concurrent uploads or reads. To handle this bottleneck, we can split reads and writes into separate services. We can have dedicated servers for reads and different servers for writes to ensure that uploads don’t hog the system. This has the added benefit of being able to scale each set of services independently.\u003c/li\u003e\n\u003cli\u003eIf users can upload a large amount of data, then efficient management of storage should also be a focus\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eHow reliable is your app expected to be?\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eif you are Instagram, your users expect 100% reliability. Therefore, you should store multiple copies of each file so that if one storage server dies, the photo can be retrieved from the other copy present on a different storage server.\n\u003cul\u003e\n\u003cli\u003eIf we want to have high availability of the system, we need to have multiple replicas of services running in the system so that even if a few services die down, the system remains available and running. Redundancy removes the single point of failure in the system.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"redundancy\"\u003eRedundancy\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#redundancy\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eAll potential bottlenecks and points of failure should be scrutinized. Think of how the system gets more complex as we implement [sharding|db.strategies.sharding]. Now we need a sharding rule to determine in which shard a row is stored. Suppose we implement round robin with \u003ccode\u003erecordId % 10\u003c/code\u003e to spread out the records evenly. Well, now we have a new problem: we cannot have the shards increment the IDs themselves, since we need the ID first before we can even determine which shard it belongs in. So to solve that, we need some sort of external key generating service. This service can generate IDs, store them in a table (to indicate that it is used) when a new item is created. Each shard can use this service, and we can have perfectly incremented IDs across all shards. However, one last issue arises. This key generation system is now a single point of failure, so we have to iterate further. We could spin up another such key generating service, and split the load between them by having one service give out even-numbered IDs and the other odd-numbered IDs. Finally, we can stick a load balancer in front of them to round-robin the load between them. In case of failure of the even-numbered service, the only consequence is that there will be more odd-numbered IDs; something we probably don't even care about.\u003c/p\u003e\n\u003ch3 id=\"back-of-the-envelope-estimations\"\u003eBack-of-the-envelope Estimations\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#back-of-the-envelope-estimations\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eFrom there, assume that each item is 10KB, so we need to store 10GB per day. If we want to store this data for an average of 10 years then we need storage capacity of 36TB.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eTo keep some margin, we will assume a 70% capacity model (meaning we don’t want to use more than 70% of our total storage capacity at any point), which raises our storage needs to 51.4TB.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eNew items per second:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e1M / (24 hours * 3600 seconds) ~= 12 pastes/sec\nresults in\n120KB of ingress per second.\u003c/li\u003e\n\u003cli\u003e12 * 10KB =\u003e 120 KB/s\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eReads per second:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e5M / (24 hours * 3600 seconds) ~= 58 reads/sec\nresults in\ntotal data egress (sent to users) will be 0.6 MB/s.\u003c/li\u003e\n\u003cli\u003e58 * 10KB =\u003e 0.6 MB/s\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThis number of records totals 3.6 Billion in 10 years. Since 6 random \u003ca title=\"Private\" href=\"https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html\" target=\"_blank\" class=\"private\"\u003ebase64 encoding (Private)\u003c/a\u003e ([A-Z, a-z, 0-9, ., -]) can be used to generate 68.7 billion unique strings, this should be sufficient for uniqueness.\u003c/p\u003e\n\u003cp\u003eSince we have 5M read requests per day, to cache 20% of these requests, we would need:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e0.2 \u003cem\u003e 5M \u003c/em\u003e 10KB ~= 10 GB\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"dendron-notes-to-review\"\u003eDendron notes to review\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#dendron-notes-to-review\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca title=\"Private\" href=\"https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html\" target=\"_blank\" class=\"private\"\u003eauth.tokens.jwt (Private)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca title=\"Private\" href=\"https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html\" target=\"_blank\" class=\"private\"\u003eapi.gateway (Private)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca title=\"Private\" href=\"https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html\" target=\"_blank\" class=\"private\"\u003edeploy.distributed.CAP-theorem (Private)\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"e-resources\"\u003eE Resources\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#e-resources\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://systemdesign.one/slack-architecture/\"\u003eSlack architecture\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://systemdesign.one/back-of-the-envelope/\"\u003eBack-of-the-envelope analysis\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"resources\"\u003eResources\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#resources\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/donnemartin/system-design-primer\"\u003eSystem Design Primer\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://systemdesign.one/distributed-counter-system-design/\"\u003eDistributed counter design\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://systemdesign.one/real-time-presence-platform-system-design/\"\u003eReal-time presence design\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://systemdesign.one/live-comment-system-design/\"\u003eLive comment system design\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://systemdesign.one/leaderboard-system-design/\"\u003eLeaderboard system design\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://systemdesign.one/system-design-pastebin/\"\u003ePastebin system design\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://systemdesign.one/url-shortening-system-design/\"\u003eURL shortening system design\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://systemdesign.one/what-is-service-discovery/\"\u003eService Discovery\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://hackingthesystemsdesigninterview.com/\"\u003eVarious system designs\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/puncsky/system-design-and-architecture\"\u003eSystem Design and Architecture\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://systemdesign.one/system-design-interview-cheatsheet\"\u003eSystem design cheatsheet\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.youtube.com/@IGotAnOffer-Engineering\"\u003eYoutube series: System Design\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","noteIndex":{"id":"8qvi4S0Dk1BAaCLhfHqAp","title":"Second Brain","desc":"","updated":1672111562730,"created":1616360437888,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"../main/thoughts-on","name":"thoughts-on"},"contentHash":"dd394dade3f08feaa5cf4d1caeb1c991","links":[],"anchors":{"tags":{"type":"header","text":"Tags","value":"tags","line":12,"column":0,"depth":3}},"children":["8aPvLrwcPnxcTwx7PdvXW","l9ldUruxqRBZwMij5KlS5","xWh3SS0J1hvRSZ7g4LvEE","cc5kdn5ay8omhcud9hjfpyk","9jNuGCXVuFaZOGZfLpKi5","mhlpKRrfT0qlXzTaapFYZ","QU1tbQ4KX64UBCWtCxAcR","U4tQLU5tRHqr9e7H3G4Gm","PvcIkEJcDtcv7luF2mBIU","2wW5Kxk794H9mfnu9VPA8","iwANjkbi3nbIovlVpepWm","XYgvsgvjzgoyvY6KAEu5Y","pT9wnWnS42pFId9UIH5he","gmXZ6Xy8f8FFQ66Z5DYqh","CjV6QXVHIqQTuZTSlSSlB","IgbLitAU1k0ioGhuvmjjS","D42jFbx0vNlT7S6QRb5ee","dFs5zopMmrh3rPgQaSkyP","W0AgEfoTzJ8VxVE4QqhSL","ggU4P3K1OhUlHBJbpgHiD","vtu2srTzCfoNUHv0Xcbxn","6kuwlrc3PT5JoQS9xZWZW","qoZ6e9KsYPestYFpO4Ce4","GPH8BieqB4dtqul80gJvX","MbW1wF5mIZ7g3DPXrOSyZ","Ay9vOAmvV8ODJFpaEkw6J","8Pi3wPs4LTxlAEOUE48Te","SDd8268l79j2cnvCVVl8F","zI5rK8mFkNghzLgbQD6ox","zCwMY5ckgKAqstOhw2Drd","i5Fya3Vzzm0rBT0ctByuo","YDbL8QXchj03NvTIZOdrk","km4fy13hx9puopyjr1ajdgj","WdAyuDkIi16pl1pnaopzx","15ax6k6x106sotobkyn3jqp","sgu2QxqDGup93hJPx8RJd","mT663nw5DUEaEGzXI98yD","Dyg6bFtxE0UkB7gz6pqzq","cn1x9vhdapyt1fvgtvfekea","0aYhvzCfaIxLaNhqNCV9Q","q9NskCGxFGNQwBDcsgNkY","wAdoBPUMHEFJkm6XVlHXW","sCYBuXnSNA259MDwhakmv","YgQusR9D6RbBgdkLuJuDh","ovHaNSb3tnl2LTdV7wwau","eqklm05q2g46ikqaqv9ijh9","8TJC5FfwKtfmH4GfOZVoO","9rKIOn3BV7ZU1FFlJxmvC","rsrE9vBXK0ehNkbEjltlZ","XTkKLi0Jg1imZ2lbhgOrv","4Fuw6OHQ5uhEVCUfXDfkb","pUEyedPYYlNSVLuiUSnge","KtoCw0HFEddGJ7GuW7GnN","BoxZ36iWEbUoRProxPo4D","gCmclfAHAt1tEcFDc24eD","TNhxyx7GEdGDM0PBI08b1","guyW7WWQNDGDALFV7tO57","YeEWZtb7FWvYTyJwF7zhR","DUrXQvolf76ILMKJm4Zt6","Jo4jAQcwgxsdxkcxUceR4","X6yPFUKIjs6tENQ3uNzE2","aRSv8qoJLyeE6xDAAUYpU","jwb0toyj23byc7krttp0l8k","ztqrUgUYssC0FAWDGZxWF","d7evrjgli013nul3mosquea","mvBLIZW424WZ5mCmjKQaB","YoV6c5CmpHYNEuYU4PsgH","JQzF2iPfQ2897j6HFCoY9","TicwTJD2oaTpncpPy93s2","KiGGs6PmvIlIt50r2tF2O","4TiqSFRd4hD0e5tyHbf4d","8F9H6GIButHtrFKXHzZFu","t5CaAEDQFRutGrV0ru97d","het26IMKUnKB7npru8tG4","GgRKYXklrXEAs9u15sOM9","PPvKHQNulUEvXEitqAZxM","SMGOfSTElTkJBezhNvkZ6","358nLIVsR9zmItfuBCWq2","xewZxeuhzI7qMvoYdcnLM","FAAtgk8cbuownxuv0Vlou","64N1mdh3JWL1WOv1dilYD","aCd3q2zSzgQnHKi1vOJFj","kh7Y1bQw7Om31yurE4CrW","5162x506d5mgwkn07plcuo3","LGnyEtwA1LlztJJwEpg6l","zoJRWH59vBCpqnm8fOpis","xlg9pngfxviby5z2qfcfpcv","G6zDrHf3Ua8R7vllalBc5","NrjfBxxDU92ByYSIJjgDM","zNcMG5nj1t69zkAFnvn5S","JIHQPGBUDqAEPzbhfFxlc","MmjHaByLtYx5sv2HzXnWd"],"parent":null,"data":{},"body":"\nWelcome to my Second Brain! Here you'll find thoughts, lessons, facts and any other interesting musings that I've come across or thought up over the years. A lot of what I have gathered over the years are originally from the minds of others, while some are my own. Some may be outdated and no longer reflect my current views. Some may contain misinformation, though I try to be rigorous with my additions. You can think of it as my personal wiki.\n\nThis Dendron vault is the sister component to the [Tech-focused Digital Garden](https://tech.kyletycholiz.com)\n\n### Tags\nThroughout the Second Brain, I have made use of tags, which give semantic meaning to the pieces of information.\n\n- `ex.` - Denotes an *example* of the preceding piece of information\n- `spec:` - Specifies that the preceding information has some degree of *speculation* to it, and may not be 100% factual. Ideally this gets clarified over time as my understanding develops.\n- `anal:` - Denotes an *analogy* of the preceding information. Often I will attempt to link concepts to others that I have previously learned.\n- `mn:` - Denotes a *mnemonic*\n- `expl:` - Denotes an *explanation*"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2,"vaultSelectionModeOnCreate":"smart"}},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"randomNote":{},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"dendronVersion":"0.83.0","vaults":[{"fsPath":"../main/thoughts-on","name":"thoughts-on"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":true,"maxPreviewsCached":10,"maxNoteLength":204800,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"enableUserTags":true,"enableHashTags":true,"enableEditorDecorations":true,"enableFullHierarchyNoteTitle":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Dendron","description":"The non-Tech Second Brain of Kyle Tycholiz"},"github":{"cname":"thoughts.kyletycholiz.com","enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"master","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"lookup","enableMermaid":true,"siteUrl":"https://thoughts.kyletycholiz.com","duplicateNoteBehavior":{"action":"useVault","payload":["thoughts-on"]},"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"2nkj5u7bxt3fo99x5t039qk"},"buildId":"Ev72apsD0Krsz6dJLOqfG","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>